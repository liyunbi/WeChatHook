name: Build WeChat Hook

on: [push]

jobs:
  build:
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v4

      - name: 1. Install Theos
        run: |
          # 标准安装：直接克隆到家目录
          git clone --recursive https://github.com/theos/theos.git $HOME/theos
          echo "THEOS=$HOME/theos" >> $GITHUB_ENV

      - name: 2. Get SDKs (The Safe Way)
        run: |
          # 标准下载：直接克隆官方 SDK 仓库到 Theos 的 sdks 目录下
          # 使用 --depth 1 减少下载时间
          git clone --depth 1 https://github.com/theos/sdks.git $HOME/theos/sdks

      - name: 3. Build It
        run: |
          # 明确指定：使用 iphone 平台，clang 编译器，14.5 版本 SDK
          # 这样编译器绝对不会找不到路
          make package FINALPACKAGE=1 TARGET=iphone:clang:14.5:14.5

      - name: 4. Upload
        uses: actions/upload-artifact@v4
        with:
          name: WeChatHook_Dylib
          # 这里的路径必须精准
          path: .theos/obj/debug/WeChatHook.dylib
